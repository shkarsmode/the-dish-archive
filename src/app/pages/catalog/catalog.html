<main class="catalog-page" [attr.data-display-mode]="settingsService.displayMode()">
    <!-- Hero Section -->
    <section class="hero" aria-label="Заголовок">
        <div class="hero-inner">
            <span class="hero-greeting">{{ greeting().emoji }} {{ greeting().text }}, Булкіна!</span>
            <h1 class="hero-title">Кулінарна<br>книга</h1>
            <p class="hero-subtitle">
                {{ greeting().suggestion }} Улюблені рецепти, зібрані з турботою.
            </p>
            <app-slot-machine (spun)="onSlotResult($event)" />

            <!-- Inline Stats Strip -->
            @if (collectionStats(); as stats) {
                <div class="stats-strip">
                    <span class="strip-item"><strong>{{ stats.totalRecipes }}</strong> рецептів</span>
                    <span class="strip-dot">·</span>
                    <span class="strip-item"><strong>{{ stats.avgRating }}</strong> ★</span>
                    <span class="strip-dot">·</span>
                    <span class="strip-item"><strong>{{ stats.favoritesCount }}</strong> ❤</span>
                    <span class="strip-dot">·</span>
                    <span class="strip-item"><strong>{{ stats.totalCookingHours }}</strong> год</span>
                </div>
            }
        </div>
    </section>

    <!-- Quick Category Chips -->
    <section class="quick-filters" aria-label="Швидкі фільтри">
        <div class="quick-filters-inner">
            @for (category of quickCategories; track category) {
                <app-tag-chip
                    [label]="getCategoryLabel(category)"
                    [active]="isCategoryActive(category)"
                    (tagClicked)="toggleQuickCategory(category)" />
            }
        </div>
    </section>

    <!-- Catalog Section -->
    <section class="catalog" id="catalog" aria-label="Каталог страв">
        <div class="catalog-inner">
            <!-- Toolbar -->
            <div class="toolbar">
                <div class="toolbar-actions">
                    <button
                        class="filter-button"
                        (click)="openFilters()"
                        [class.has-filters]="dishService.hasActiveFilters()">
                        <span class="material-symbols-outlined">tune</span>
                        @if (dishService.hasActiveFilters()) {
                            <span class="filter-badge">
                                <span class="material-symbols-outlined">circle</span>
                            </span>
                        }
                    </button>
                    <app-sort-dropdown />
                </div>
                <div class="toolbar-search">
                    <app-search-bar />
                </div>
            </div>

            <!-- Active Filters Display -->
            @if (dishService.hasActiveFilters()) {
                <div class="active-filters">
                    <span class="active-filters-label">Активні фільтри:</span>
                    <button class="clear-all-filters" (click)="dishService.resetFilters()">
                        Скинути все
                    </button>
                </div>
            }

            <!-- Results Count -->
            @if (!dishService.isLoading()) {
                <div class="results-info">
                    <span class="results-count">
                        {{ dishService.totalFilteredCount() }}
                        {{ dishService.totalFilteredCount() === 1 ? 'страва' : 'страв' }}
                    </span>
                </div>
            }

            <!-- Dish Grid -->
            @if (dishService.isLoading()) {
                <div class="dish-grid">
                    @for (item of skeletonItems; track $index) {
                        <app-skeleton-card />
                    }
                </div>
            } @else if (dishService.visibleDishes().length === 0) {
                <app-empty-state
                    icon="search_off"
                    title="Нічого не знайдено"
                    description="Спробуйте змінити параметри пошуку або скинути фільтри" />
            } @else {
                <div class="dish-grid">
                    @for (dish of dishService.visibleDishes(); track dish.id) {
                        <app-dish-card [dish]="dish" [displayMode]="settingsService.displayMode()" />
                    }
                </div>

                <!-- Infinite Scroll Sentinel -->
                @if (dishService.hasMore()) {
                    <div class="load-more-sentinel" #scrollSentinel>
                        <div class="load-more-spinner">
                            <span class="spinner-dot"></span>
                            <span class="spinner-dot"></span>
                            <span class="spinner-dot"></span>
                        </div>
                        <span class="load-more-text">Завантажуємо ще…</span>
                    </div>
                }
            }
        </div>
    </section>

    <!-- Filter Drawer -->
    <app-filter-drawer #filterDrawer />
</main>
